<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Andzen Klaviyo Audit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <!-- CSS path - use relative path that works for both local and production -->
  <link rel="stylesheet" href="style.css" id="main-stylesheet" />
  <!-- API Configuration - Update this script tag with your Railway URL after deployment -->
  <script>
    // Set API URL for production (update this after Railway deployment)
    window.API_URL = window.API_URL || 'https://web-production-2ce0.up.railway.app';
  </script>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="brand">
        <div class="logo-text">ANDZEN</div>
        <div class="brand-text">
          <p class="eyebrow">Internal Tool</p>
          <h1>Prospect Audit Launcher</h1>
          <p class="sub">Generate comprehensive Klaviyo audit reports with one click</p>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info" id="user-info" style="display: none;">
          <span class="user-name" id="user-name"></span>
          <span class="user-role" id="user-role"></span>
          <button class="btn-logout" id="btn-logout">Logout</button>
        </div>
        <div class="status" id="status-pill">Idle</div>
      </div>
    </header>

    <!-- Login Form -->
    <main id="login-section" class="login-container" style="display: none;">
      <section class="card login-card">
        <h2>Login</h2>
        <form id="login-form">
          <label>
            Username
            <input type="text" name="username" placeholder="Enter your username" required autocomplete="username" />
          </label>
          <label>
            Password
            <input type="password" name="password" placeholder="Enter your password" required autocomplete="current-password" />
          </label>
          <button type="submit" id="login-btn">Login</button>
          <div id="login-error" class="error" style="display: none; margin-top: 12px;"></div>
        </form>
      </section>
    </main>

    <!-- Main Application (shown after login) -->
    <main id="app-section" class="grid" style="display: none;">
      <section class="card form-card">
        <h2>Audit Inputs</h2>
        <form id="audit-form">
          <label>
            Klaviyo API Key
            <div class="input-with-test">
              <input type="password" name="api_key" id="klaviyo-api-key" placeholder="Klaviyo private API key" required />
              <button type="button" class="btn-test-api" onclick="testKlaviyoAPI()" title="Test Klaviyo API connection">
                <span class="test-icon">üîå</span>
                <span class="test-text">Test</span>
              </button>
              <span class="api-status" id="klaviyo-api-status"></span>
            </div>
          </label>
          
          <div class="section-divider">
            <h3>LLM Configuration (Optional)</h3>
          </div>
          
          <label>
            LLM Provider
            <select name="llm_provider" id="llm-provider-select">
              <option value="">Select a provider...</option>
              <option value="claude">Claude (Anthropic)</option>
              <option value="openai">OpenAI</option>
              <option value="gemini">Gemini (Google)</option>
            </select>
          </label>
          
          <label id="claude-api-key-label" style="display: none;">
            Claude API Key
            <div class="input-with-test">
              <input type="password" name="anthropic_api_key" id="claude-api-key" placeholder="Anthropic API key" />
              <button type="button" class="btn-test-api" onclick="testLLMAPI('claude')" title="Test Claude API connection">
                <span class="test-icon">üîå</span>
                <span class="test-text">Test</span>
              </button>
              <span class="api-status" id="claude-api-status"></span>
            </div>
          </label>
          <label id="claude-model-label" style="display: none;">
            Claude Model
            <select name="claude_model" id="claude-model-select">
              <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
              <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
              <option value="claude-3-opus-20240229">Claude 3 Opus</option>
            </select>
          </label>
          
          <label id="openai-api-key-label" style="display: none;">
            OpenAI API Key
            <div class="input-with-test">
              <input type="password" name="openai_api_key" id="openai-api-key" placeholder="OpenAI API key" />
              <button type="button" class="btn-test-api" onclick="testLLMAPI('openai')" title="Test OpenAI API connection">
                <span class="test-icon">üîå</span>
                <span class="test-text">Test</span>
              </button>
              <span class="api-status" id="openai-api-status"></span>
            </div>
          </label>
          <label id="openai-model-label" style="display: none;">
            OpenAI Model
            <select name="openai_model" id="openai-model-select">
              <option value="gpt-4o">GPT-4o</option>
              <option value="gpt-4-turbo">GPT-4 Turbo</option>
              <option value="gpt-4">GPT-4</option>
            </select>
          </label>
          
          <label id="gemini-api-key-label" style="display: none;">
            Gemini API Key
            <div class="input-with-test">
              <input type="password" name="gemini_api_key" id="gemini-api-key" placeholder="Gemini API key" />
              <button type="button" class="btn-test-api" onclick="testLLMAPI('gemini')" title="Test Gemini API connection">
                <span class="test-icon">üîå</span>
                <span class="test-text">Test</span>
              </button>
              <span class="api-status" id="gemini-api-status"></span>
            </div>
          </label>
          <label id="gemini-model-label" style="display: none;">
            Gemini Model
            <select name="gemini_model" id="gemini-model-select">
              <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
              <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
              <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
            </select>
          </label>
          
          <label>
            Client Name
            <input type="text" name="client_name" placeholder="Company name" required />
          </label>
          <label>
            Client Code (Optional)
            <input type="text" name="client_code" placeholder="Andzen client code" />
          </label>
          <label>
            Industry
            <select name="industry" id="industry-select">
              <option value="apparel_accessories">Apparel & Accessories</option>
              <option value="fashion_accessories">Fashion & Accessories</option>
              <option value="toys_collectibles">Toys & Collectibles</option>
              <option value="ecommerce_collections">E-commerce Collections</option>
              <option value="beauty_cosmetics">Beauty & Cosmetics</option>
              <option value="electronics">Electronics</option>
              <option value="home_garden">Home & Garden</option>
              <option value="food_beverage">Food & Beverage</option>
              <option value="health_fitness">Health & Fitness</option>
              <option value="retail">General Retail</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label>
            Analysis Period
            <select name="period" id="period-select">
              <option value="90">3 Months (90 days)</option>
              <option value="180">6 Months (180 days)</option>
              <option value="365">1 Year (365 days)</option>
              <option value="ytd" id="ytd-option">Year to Date (YTD)</option>
              <option value="custom">Custom Date Range</option>
            </select>
          </label>
          <div class="two-col" id="custom-dates" style="display: none;">
            <label>
              Start Date
              <input type="date" name="start_date" />
            </label>
            <label>
              End Date
              <input type="date" name="end_date" />
            </label>
          </div>
          <label>
            Auditor Name
            <input type="text" name="auditor_name" placeholder="Andzen Team" />
          </label>
          <button type="submit" id="submit-btn">Generate Audit</button>
        </form>
        <p class="hint">Tip: Select analysis period. System will automatically compare with previous period.</p>
      </section>

      <section class="card results-card">
        <h2>Result</h2>
        <div id="result-box" class="result-box">
          <p class="muted">No audit run yet.</p>
        </div>
        <div id="progress-container" class="progress-container" style="display: none;">
          <div class="progress-header">
            <div class="progress-info">
              <span class="progress-label">Processing Audit Report</span>
              <span class="progress-time" id="progress-time">Estimated time: 25-30 minutes</span>
            </div>
          </div>
          <div class="progress-bar-wrapper">
            <div class="progress-bar" id="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
              <div class="progress-shine"></div>
            </div>
            <div class="progress-percentage" id="progress-percentage">0%</div>
          </div>
          <div class="progress-stages" id="progress-stages">
            <div class="stage active" data-stage="0">
              <div class="stage-icon">üìä</div>
              <div class="stage-label">Extracting Data</div>
            </div>
            <div class="stage" data-stage="1">
              <div class="stage-icon">ü§ñ</div>
              <div class="stage-label">AI Analysis</div>
            </div>
            <div class="stage" data-stage="2">
              <div class="stage-icon">üìù</div>
              <div class="stage-label">Generating Report</div>
            </div>
            <div class="stage" data-stage="3">
              <div class="stage-icon">‚úÖ</div>
              <div class="stage-label">Finalizing</div>
            </div>
          </div>
        </div>
        <div id="log-box" class="log-box" aria-live="polite"></div>
      </section>
    </main>
  </div>

  <!-- Modular JavaScript - Load in dependency order -->
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/audit.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/editor.js"></script>
  <script src="js/main.js"></script>
  
  <script>
    // All JavaScript has been modularized into separate files
    // See frontend/js/ directory for all modules
    // Modules are loaded in dependency order above
  </script>
</body>
</html>
