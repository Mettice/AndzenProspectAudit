{#
  Automation Performance Overview Section - Page 7
  
  Data required:
  - automation_overview_data: dict with period_days, flows, summary, chart_data, narrative
#}

<section class="section page" data-page="7" data-section="automation_overview_basic" id="automation_overview_basic">
    <h1 class="section-title">OVERALL AUTOMATION PERFORMANCE ({{ automation_overview_data.period_days }} DAYS)</h1>
    
    <div class="automation-intro">
        {% if automation_overview_data.narrative %}
            {{ automation_overview_data.narrative|safe }}
        {% else %}
            <p>
                The purpose of compiling an overview of your flows is to assess whether any metrics are 
                underperforming and require attention. However, it appears that your flow metrics are generally 
                healthy and do not raise any significant concerns.
            </p>
        {% endif %}
    </div>
    
    <!-- Email Automation Table -->
    <div class="automation-table-section">
        <div class="table-title-bar">EMAIL AUTOMATION</div>
        
        <table class="data-table-green">
            <thead>
                <tr>
                    <th>Flow Name</th>
                    <th>Performance Tier</th>
                    <th>Open Rate</th>
                    <th>Click Rate</th>
                    <th>Conversion Rate</th>
                    <th>Revenue</th>
                    <th>Strategic Focus</th>
                </tr>
            </thead>
            <tbody>
                {% for flow in automation_overview_data.flows %}
                <tr>
                    <td>{{ flow.name }}</td>
                    <td>
                        <span class="performance-tier tier-{{ (flow.performance_tier|lower) if flow.performance_tier else 'unknown' }}">
                            {{ flow.performance_tier if flow.performance_tier else "N/A" }}
                        </span>
                    </td>
                    <td>{{ flow.avg_open_rate|round(2) }}%</td>
                    <td>{{ flow.avg_click_rate|round(2) }}%</td>
                    <td>{{ flow.avg_placed_order_rate|round(2) }}%</td>
                    <td>${{ "{:,.0f}".format(flow.revenue) }}</td>
                    <td>{{ flow.strategic_focus if flow.strategic_focus else "Optimization Analysis" }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="no-data">No flow data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Flow Issues Detection -->
    {% if automation_overview_data.flow_issues %}
    <div class="flow-issues-section">
        <h4 class="subsection-title">Flow Issues & Opportunities</h4>
        
        <!-- Missing Flows -->
        {% if automation_overview_data.flow_issues.missing %}
        <div class="flow-issue-category">
            <h5 class="issue-category-title">Missing Flows (Opportunities)</h5>
            {% for missing in automation_overview_data.flow_issues.missing %}
            <div class="flow-issue-box opportunity">
                <div class="issue-header">
                    <strong>{{ missing.flow_type|replace('_', ' ')|title }}</strong>
                    <span class="issue-priority priority-{{ missing.priority|lower }}">{{ missing.priority }}</span>
                </div>
                <p class="issue-description">{{ missing.opportunity }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Duplicate Flows -->
        {% if automation_overview_data.flow_issues.duplicates %}
        <div class="flow-issue-category">
            <h5 class="issue-category-title">Duplicate Flows (Requires Review)</h5>
            {% for duplicate in automation_overview_data.flow_issues.duplicates %}
            <div class="flow-issue-box warning">
                <div class="issue-header">
                    <strong>{{ duplicate.flow_type|replace('_', ' ')|title }}</strong>
                    <span class="issue-priority priority-{{ duplicate.priority|lower }}">{{ duplicate.priority }}</span>
                </div>
                <p class="issue-description">{{ duplicate.issue }}</p>
                <p class="issue-flows"><strong>Flows:</strong> {{ duplicate.flows|join(', ') }}</p>
                <p class="issue-recommendation"><strong>Recommendation:</strong> {{ duplicate.recommendation }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Zero Deliveries -->
        {% if automation_overview_data.flow_issues.zero_deliveries %}
        <div class="flow-issue-category">
            <h5 class="issue-category-title">Zero Deliveries (Critical)</h5>
            {% for zero in automation_overview_data.flow_issues.zero_deliveries %}
            <div class="flow-issue-box critical">
                <div class="issue-header">
                    <strong>{{ zero.flow_name }}</strong>
                    <span class="issue-priority priority-{{ zero.priority|lower }}">{{ zero.priority }}</span>
                </div>
                <p class="issue-description">{{ zero.issue }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Performance Analysis -->
    {% if automation_overview_data.analysis_text %}
    <div class="automation-analysis">
        {{ automation_overview_data.analysis_text|safe }}
    </div>
    {% endif %}
    
    <!-- Flow Performance Summary -->
    <div class="flow-summary-section">
        <div class="flow-summary-header">
            <div class="summary-title">Flow performance summary</div>
            <div class="summary-tabs">
                <span class="tab">Overview</span>
                <span class="tab">Metrics</span>
                <span class="tab active">Top performing</span>
            </div>
        </div>
        
        <div class="summary-content">
            <div class="summary-metrics">
                <div class="summary-metric">
                    <span class="metric-big">${{ "{:,.0f}".format(automation_overview_data.summary.total_conversion_value) }}</span>
                    <span class="metric-label">Flow Revenue</span>
                    {% if automation_overview_data.summary.vs_previous_period %}
                    <span class="metric-trend trend-up">
                        ↗ {{ automation_overview_data.summary.vs_previous_period }}% vs. previous {{ automation_overview_data.period_days }} days
                    </span>
                    {% endif %}
                </div>
                
                <div class="summary-metric">
                    <span class="metric-big">{{ "{:,}".format(automation_overview_data.summary.total_recipients) }}</span>
                    <span class="metric-label">Total Recipients</span>
                    {% if automation_overview_data.summary.recipients_vs_previous %}
                    <span class="metric-trend trend-up">
                        ↗ {{ automation_overview_data.summary.recipients_vs_previous }}% vs. previous {{ automation_overview_data.period_days }} days
                    </span>
                    {% endif %}
                </div>
                
                <div class="summary-metric">
                    <span class="metric-big">{{ automation_overview_data.flows|length }}</span>
                    <span class="metric-label">Active Flows</span>
                </div>
            </div>
            
            <div class="summary-chart">
                {% set chart_id = "flow_performance_chart" %}
                {% set chart_type = "bar_line" %}
                {% set height = 200 %}
                {% set data = automation_overview_data.chart_data if automation_overview_data.chart_data else {} %}
                <!-- Chart removed - using matplotlib-generated images only -->
                <div class="chart-error" style="padding: 2rem; text-align: center; color: #666; border: 1px dashed #ccc; border-radius: 8px;">
                    <p>Chart generation failed. Please check the logs for details.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Narrative -->
    <div class="automation-narrative">
        {% if automation_overview_data.narrative_text %}
            {{ automation_overview_data.narrative_text|safe }}
        {% elif automation_overview_data.summary.vs_previous_period %}
            <p>
                In terms of revenue, your revenue from flows has seen a {{ automation_overview_data.summary.vs_previous_period }}% growth 
                compared to the previous period. This growth can be attributed to an increase in email deliveries 
                or {{ automation_overview_data.summary.recipients_vs_previous }}% more compared to the previous period.
            </p>
        {% else %}
            <p>
                Your email flows are performing well. Review the metrics above to identify optimization opportunities.
            </p>
        {% endif %}
    </div>
</section>

<style>
.automation-intro p {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.17rem; /* Match sample: 1.166667em */
    line-height: 1.7;
    margin-bottom: 2rem;
    color: #000000;
}

.automation-table-section {
    margin: 2rem 0;
}

.table-title-bar {
    background: #65DA4F;
    color: #000000;
    padding: 0.75rem 1rem;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    font-size: 0.833rem;
    letter-spacing: 0.05em;
}

/* Flow Issues Styles */
.flow-issues-section {
    margin: 2rem 0;
}

.subsection-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.17rem;
    font-weight: 700;
    color: #000000;
    margin-bottom: 1rem;
    margin-top: 1.5rem;
    line-height: 1.3;
}

.flow-issue-category {
    margin-bottom: 2rem;
}

.issue-category-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    color: #000000;
    margin-bottom: 1rem;
}

.flow-issue-box {
    background: #FFFFFF;
    border-left: 4px solid #65DA4F;
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
}

.flow-issue-box.opportunity {
    border-left-color: #3B82F6;
}

.flow-issue-box.warning {
    border-left-color: #F59E0B;
}

.flow-issue-box.critical {
    border-left-color: #EF4444;
}

.issue-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    font-family: 'Montserrat', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: #000000;
}

.issue-priority {
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
}

.issue-description,
.issue-flows,
.issue-recommendation {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.95rem;
    line-height: 1.6;
    color: #262626;
    margin-bottom: 0.5rem;
}

.issue-recommendation {
    margin-top: 0.75rem;
    margin-bottom: 0;
}

.automation-analysis {
    margin: 2rem 0;
}

.automation-analysis p {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.17rem;
    line-height: 1.7;
    color: #000000;
}

/* Performance Tier Badges */
.performance-tier {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.performance-tier.tier-excellent {
    background: #D1FAE5;
    color: #065F46;
}

.performance-tier.tier-good {
    background: #DBEAFE;
    color: #1E40AF;
}

.performance-tier.tier-average {
    background: #FEF3C7;
    color: #92400E;
}

.performance-tier.tier-poor {
    background: #FEE2E2;
    color: #991B1B;
}

.performance-tier.tier-unknown {
    background: #F3F4F6;
    color: #6B7280;
}

.flow-summary-section {
    background: #FFFFFF;
    border: 1px solid #E5E7EB;
    margin: 2rem 0;
}

.flow-summary-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #E5E7EB;
}

.summary-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.17rem;
    font-weight: 700;
    color: #000000;
}

.summary-tabs {
    display: flex;
    gap: 0.5rem;
}

.tab {
    padding: 0.5rem 1rem;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.833rem;
    color: #717171;
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.tab.active {
    color: #000000;
    border-bottom-color: #65DA4F;
}

.summary-content {
    padding: 1.5rem;
}

.summary-metrics {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-metric {
    text-align: center;
    padding: 1rem;
    background: #F9FAFB;
    border-radius: 4px;
}

.metric-big {
    display: block;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: #000000;
    margin-bottom: 0.5rem;
}

.metric-label {
    display: block;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.833rem;
    color: #717171;
    margin-bottom: 0.5rem;
}

.metric-trend {
    display: block;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.75rem;
    color: #065F46;
}

.summary-chart {
    margin-top: 1rem;
}

.automation-narrative {
    margin-top: 2rem;
}

.automation-narrative p {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.17rem;
    line-height: 1.7;
    color: #000000;
}
</style>
